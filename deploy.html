<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="API" href="api.html" /><link rel="prev" title="Flask configuration" href="flask_config.html" />

    <!-- Generated with Sphinx 8.0.2 and Furo 2024.08.06 -->
        <title>Deploying your website - Rec League 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">Rec League 0.1 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="_static/AlternateLogo.png" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="_static/Logo.png" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">Rec League 0.1 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="user_guide.html">Using Rec Leagues</a></li>
<li class="toctree-l1"><a class="reference internal" href="admin.html">Admin</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="developer.html">Developer</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Developer</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="first_website.html">Creating your first website</a></li>
<li class="toctree-l2"><a class="reference internal" href="flask_config.html">Flask configuration</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Deploying your website</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html">API</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/deploy.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="deploying-your-website">
<h1>Deploying your website<a class="headerlink" href="#deploying-your-website" title="Link to this heading">¶</a></h1>
<p>If you want the website to be accessible from the internet, you will need to deploy to a web server with a static address. The hardware requirements for a machine are low end especially if you intend the traffic to be low on your rec league website. Virtual machines offer a quick way to deploy a web application.</p>
<p>Buying a domain name is recommended, but not necessary to run the web application. Custom domain names can be bought at various websites.</p>
<p>Correy Schafer has a great <a class="reference external" href="https://youtu.be/goToXTC96Co">YouTube video</a> on deploying Flask applications. Make sure to check out his video if anything remains unclear.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For security reasons, it is recommended that you don’t run the app on your web server’s root user. Also, enable SSH key authentication on your web server instead of password authentication to help increase security.</p>
</div>
<section id="setting-production-mode">
<h2>Setting production mode<a class="headerlink" href="#setting-production-mode" title="Link to this heading">¶</a></h2>
<p>Once you have a web server running, transfer the repository files either through git or a file transfer. Once transferred to your server, make sure to set CONFIG_PATH and FLASK_CONFIG_PATH environment variables. Also make sure to install the required Python packages again, preferably in a virtual environment.</p>
<p>The application currently runs in debug mode, which will show debug logs on server errors. This is helpful in development, but in production it is necessary to remove this for security reasons. Debug mode is turned off by setting DEBUG to False in the Flask config file:</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">Flask config file</span><a class="headerlink" href="#id4" title="Link to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>

<span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
</section>
<section id="disable-firewall">
<h2>Disable firewall<a class="headerlink" href="#disable-firewall" title="Link to this heading">¶</a></h2>
<p>The app running connected with the internet will need a firewall. Check out setting up a firewall on your web server machine. The following is how to set up a firewall on Ubuntu using <a class="reference external" href="https://wiki.ubuntu.com/UncomplicatedFirewall">UncomplicatedFirewall (UFW)</a>.</p>
<p>Install UFW using apt install:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="n">ufw</span>
</pre></div>
</div>
<p>Configure the firewall to allow SSH, HTTP, and HTTPS traffic by the following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">sudo</span> <span class="n">ufw</span> <span class="n">default</span> <span class="n">allow</span> <span class="n">outgoing</span>
<span class="linenos">2</span><span class="n">sudo</span> <span class="n">ufw</span> <span class="n">default</span> <span class="n">deny</span> <span class="n">incoming</span>
<span class="linenos">3</span><span class="n">sudo</span> <span class="n">ufw</span> <span class="n">allow</span> <span class="n">ssh</span>
<span class="linenos">4</span><span class="n">sudo</span> <span class="n">ufw</span> <span class="n">allow</span> <span class="n">http</span><span class="o">/</span><span class="n">tcp</span>
<span class="linenos">5</span><span class="n">sudo</span> <span class="n">ufw</span> <span class="n">allow</span> <span class="n">https</span>
<span class="linenos">6</span>
<span class="linenos">7</span><span class="n">sudo</span> <span class="n">ufw</span> <span class="n">enable</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you don’t allow SSH (line 3 above), you will be unable to login into to your web server remotely!</p>
</div>
<p>Check that all changes to UFW worked by running the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">ufw</span> <span class="n">status</span>
</pre></div>
</div>
<div class="admonition-quick-test admonition">
<p class="admonition-title">Quick test</p>
<p>For a quick test to see if your site working on the internet, open up the port 5000:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">ufw</span> <span class="n">allow</span> <span class="mi">5000</span>
</pre></div>
</div>
<p>Next, to run the application on your web address (instead of local address 127.0.0.1), we will use the <a class="reference external" href="https://flask.palletsprojects.com/en/3.0.x/cli/">Flask CLI</a> to set our host name and run the application. The host name <code class="docutils literal notranslate"><span class="pre">0.0.0.0</span></code> will open the Flask application to all addresses on the server. Run the following flask CLI command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">flask</span> <span class="o">--</span><span class="n">app</span> <span class="n">run</span> <span class="n">run</span> <span class="o">--</span><span class="n">host</span><span class="o">=</span><span class="mf">0.0.0.0</span>
</pre></div>
</div>
<p>Then check the website out at: <code class="docutils literal notranslate"><span class="pre">&lt;your_web_server_ip&gt;:5000</span></code>, where <code class="docutils literal notranslate"><span class="pre">&lt;your_web_server_ip&gt;</span></code> is the static IP address of your running web server. All functionality should work with the application.</p>
<p>Once finished testing, disable the port on the firewall:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">ufw</span> <span class="n">delete</span> <span class="n">allow</span> <span class="mi">5000</span>
</pre></div>
</div>
</div>
</section>
<section id="serving-the-application">
<h2>Serving the application<a class="headerlink" href="#serving-the-application" title="Link to this heading">¶</a></h2>
<p>The website can be served to the internet in a variety of ways. A straightforward approach would be to run the Flask application with the port of HTTPS, but this would lack in performance compared to other methods.</p>
<p>The approach shown here is using <a class="reference external" href="https://nginx.org">NGINX</a>, <a class="reference external" href="https://gunicorn.org">Gunicorn</a>, and <a class="reference external" href="http://supervisord.org">Supervisor</a> on Ubuntu to serve the Flask application.</p>
<ul class="simple">
<li><p><strong>NGINX</strong> is a performant web server that will be used to host our static files and direct all other traffic to Gunicorn.</p></li>
<li><p><strong>Gunicorn</strong> is the middle man between the NGINX web server and the Flask application. It allows communication between the two and ensures web requests are handled smoothly and efficiently.</p></li>
<li><p><strong>Supervisor</strong> is a program that monitors running processes. It will make sure Gunicorn is running, and restart it if it crashes.</p></li>
</ul>
<section id="id1">
<h3>NGINX<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h3>
<p>NGINX can be installed on Ubuntu with apt install:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="n">nginx</span>
</pre></div>
</div>
<p>NGINX will need to be able to access your repository folder (to serve the static files), so ensure NGINX is able to access the repository by the following command on Ubuntu:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">www</span><span class="o">-</span><span class="n">data</span> <span class="n">namei</span> <span class="o">&lt;</span><span class="n">path_to_repo</span><span class="o">&gt;/</span><span class="n">recLeague</span><span class="o">/</span><span class="n">static</span><span class="o">/</span>
</pre></div>
</div>
<p>If result shows Permission denied, add the <code class="docutils literal notranslate"><span class="pre">www-data</span></code> user to the user that contains the repository (also make sure that user has proper privileges itself):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">gpasswd</span> <span class="o">-</span><span class="n">a</span> <span class="n">www</span><span class="o">-</span><span class="n">data</span> <span class="o">&lt;</span><span class="n">your_user</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Next, remove the default NGINX configuration file at <code class="docutils literal notranslate"><span class="pre">/etc/nginx/sites-enabled/default</span></code> and create your own configuration file at <code class="docutils literal notranslate"><span class="pre">/etc/nginx/sites-enabled/&lt;your_app_name_here&gt;</span></code> with the following information:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">server</span><span class="p">{</span>
        <span class="n">listen</span> <span class="mi">80</span><span class="p">;</span>
        <span class="n">server_name</span> <span class="o">&lt;</span><span class="n">your_domain_or_ip</span><span class="o">&gt;</span><span class="p">;</span>

        <span class="c1"># Serve static files through NGINX</span>
        <span class="n">location</span> <span class="o">/</span><span class="n">static</span> <span class="p">{</span>
                <span class="c1"># Set all static files to require authentication</span>
                <span class="n">auth_request</span> <span class="o">/</span><span class="n">auth</span><span class="p">;</span>
                <span class="n">alias</span> <span class="o">&lt;</span><span class="n">path_to_repo</span><span class="o">&gt;/</span><span class="n">recLeague</span><span class="o">/</span><span class="n">static</span><span class="p">;</span>

                <span class="c1"># Turn off authentication for static files in the public folder</span>
                <span class="n">location</span> <span class="o">/</span><span class="n">static</span><span class="o">/</span><span class="n">public</span> <span class="p">{</span>
                        <span class="n">auth_request</span> <span class="n">off</span><span class="p">;</span>
                <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1"># Pass off to Gunicorn for all other routes</span>
        <span class="n">location</span> <span class="o">/</span> <span class="p">{</span>
                <span class="n">proxy_pass</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8000</span><span class="p">;</span>
                <span class="n">include</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">proxy_params</span><span class="p">;</span>
                <span class="n">proxy_redirect</span> <span class="n">off</span><span class="p">;</span>
        <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Where the following variables are:</p>
<ul class="simple">
<li><p><strong>&lt;your_domain_or_ip&gt;</strong>: Use your custom domain name if you have one. Otherwise use the static IP address of the web server.</p></li>
<li><p><strong>&lt;path_to_repo&gt;</strong>: Path to the root repository folder.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the configuration, the static route is protected by the <code class="docutils literal notranslate"><span class="pre">auth_request</span></code> to prevent outside users gaining access to scorecard pictures.</p>
</div>
<p>If you planning to upload scorecard pictures and expect the file size to be large, increase the max file size by adding the following line in <code class="docutils literal notranslate"><span class="pre">/etc/nginx/nginx.connf</span></code> in the <code class="docutils literal notranslate"><span class="pre">http</span></code> section:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>

<span class="n">client_max_body_size</span> <span class="o">&lt;</span><span class="n">number_of_megabytes</span><span class="o">&gt;</span><span class="n">M</span><span class="p">;</span>
</pre></div>
</div>
<p>Where &lt;number_of_megabytes&gt; is an integer number of megabytes for the largest accepted file size. Learn more about <a class="reference external" href="https://nginx.org/en/docs/http/ngx_http_core_module.html#client_max_body_size">client_max_body_size</a> on NGINX.</p>
<p>Restart NGINX to apply the changes by running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">restart</span> <span class="n">nginx</span>
</pre></div>
</div>
</section>
<section id="id2">
<h3>Gunicorn<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h3>
<p>Gunicorn can be installed with pip. Make sure your Python virtual environment is activated.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">gunicorn</span>
</pre></div>
</div>
<div class="admonition-quick-test admonition">
<p class="admonition-title">Quick test</p>
<p>For a quick test to see if NGINX and Gunicorn are working correctly, run the application using Gunicorn in the root folder of the project repository:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gunicorn</span> <span class="n">run</span><span class="p">:</span><span class="n">app</span>
</pre></div>
</div>
<p>The application should be viewable at your web server static IP address on port <code class="docutils literal notranslate"><span class="pre">80</span></code>, and all functionality should work.</p>
</div>
</section>
<section id="id3">
<h3>Supervisor<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h3>
<p>Finally, install Supervisor on Ubuntu with apt install:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="n">supervisor</span>
</pre></div>
</div>
<p>Configure Supervisor to run Gunicorn by adding the following configuration file at <code class="docutils literal notranslate"><span class="pre">/etc/supervisor/conf.d/&lt;your_app_name_here&gt;.conf</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">program</span><span class="p">:</span><span class="o">&lt;</span><span class="n">your_app_name_here</span><span class="o">&gt;</span><span class="p">]</span>
<span class="n">user</span><span class="o">=&lt;</span><span class="n">your_ubuntu_user</span><span class="o">&gt;</span>
<span class="n">directory</span><span class="o">=&lt;</span><span class="n">path_to_repository_folder</span><span class="o">&gt;</span>
<span class="n">command</span><span class="o">=&lt;</span><span class="n">path_to_gunicorn_executable</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">w</span> <span class="o">&lt;</span><span class="n">number_of_workers</span><span class="o">&gt;</span> <span class="n">run</span><span class="p">:</span><span class="n">app</span>
<span class="n">environment</span><span class="o">=&lt;</span><span class="n">your_environment_variables</span><span class="o">&gt;</span>

<span class="n">autostart</span><span class="o">=</span><span class="n">true</span>
<span class="n">autorestart</span><span class="o">=</span><span class="n">true</span>
<span class="n">stopasgroup</span><span class="o">=</span><span class="n">true</span>
<span class="n">killasgroup</span><span class="o">=</span><span class="n">true</span>

<span class="n">stderr_logfile</span><span class="o">=&lt;</span><span class="n">your_err_log_path</span><span class="o">&gt;/</span><span class="n">app</span><span class="o">.</span><span class="n">err</span><span class="o">.</span><span class="n">log</span>
<span class="n">stdout_logfile</span><span class="o">=&lt;</span><span class="n">your_out_log_path</span><span class="o">&gt;/</span><span class="n">app</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">log</span>
</pre></div>
</div>
<p>Where the following variables in the configuration file are:</p>
<ul>
<li><p><strong>&lt;your_app_name_here&gt;</strong>: Choose a name for your program.</p></li>
<li><p><strong>&lt;your_ubuntu_user&gt;</strong>: User account name on Ubuntu.</p></li>
<li><p><strong>&lt;path_to_repository_folder&gt;</strong>: Path to the Rec League repository.</p></li>
<li><dl>
<dt><strong>command</strong></dt><dd><ul class="simple">
<li><p><strong>&lt;path_to_gunicorn_executable&gt;</strong>: Path to the installed Gunicorn executable. Importantly, use the Gunicorn from your virtual environment to ensure the required Python packages.</p></li>
<li><p><strong>&lt;number_of_workers&gt;</strong>: Integer number of workers Gunicorn will use to run application. This number should usually be <code class="docutils literal notranslate"><span class="pre">2*n</span> <span class="pre">+</span> <span class="pre">1</span></code>, where <code class="docutils literal notranslate"><span class="pre">n</span></code> is the number of cpu cores on your computer. See <a class="reference external" href="https://docs.gunicorn.org/en/latest/design.html#how-many-workers">Gunicorn’s FAQ</a> for more information.</p></li>
<li><p>Example:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">command</span><span class="o">=/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">flask</span><span class="o">-</span><span class="n">rec</span><span class="o">-</span><span class="n">league</span><span class="o">/</span><span class="n">venv</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">gunicorn</span> <span class="o">-</span><span class="n">w</span> <span class="mi">3</span> <span class="n">run</span><span class="p">:</span><span class="n">app</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><strong>&lt;environment&gt;</strong>: Optional list of your environment variables. This can include all environment variables for running the application, otherwise make sure the variables are set either on server boot up or by executing a script in the command using the <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> operator.</dt><dd><ul class="simple">
<li><p>Example:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">environment</span><span class="o">=</span><span class="n">FLASK_CONFIG_PATH</span><span class="o">=</span><span class="s2">&quot;&lt;path_to_config&gt;&quot;</span><span class="p">,</span><span class="n">LEAGUE_CONFIG_PATH</span><span class="o">=</span><span class="s2">&quot;&lt;league_config_path&gt;&quot;</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><p><strong>&lt;your_err_log_path&gt;</strong>, <strong>&lt;your_out_log_path&gt;</strong>: Optional paths for log files from the application. Make sure the log path exists before running Supervisor. A good place for logs on Ubuntu are in <code class="docutils literal notranslate"><span class="pre">/var/log/&lt;your_app_name_here&gt;/&lt;log_file_name&gt;</span></code>.</p></li>
</ul>
<p>See <a class="reference external" href="http://supervisord.org/configuration.html#program-x-section-values">Supervisor program configuration</a> for more details.</p>
<p>Restart Supervisor to apply the configuration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">supervisorctl</span> <span class="n">reload</span>
</pre></div>
</div>
<p>Your application should now be running. If you can’t view the web application check the application logs or the log from Supervisor.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Anytime you want to apply code or configuration changes to the app, make sure to reload the server by running the command above.</p>
</div>
</section>
</section>
<section id="custom-domain-name">
<h2>Custom domain name<a class="headerlink" href="#custom-domain-name" title="Link to this heading">¶</a></h2>
<p>If you have a custom domain name for this website, make sure to add the records to the web server static IP address. The records will take a while to update. Check out the website where you purchased the domain name for more information on adding records.</p>
</section>
<section id="enabling-tls">
<h2>Enabling TLS<a class="headerlink" href="#enabling-tls" title="Link to this heading">¶</a></h2>
<p>It is highly recommended to use TLS with this application to encrypt all web traffic with HTTPS. There are a variety of ways to generate TLS certificates. In this example, we will use a certificate from <a class="reference external" href="https://letsencrypt.org">Lets Encrypt</a>, but you can choose any certificate authority.</p>
<p>Let’s Encrypt only allows certificates for domain names, so you must have a custom domain named linked as described in the section before.</p>
<p>We will install the Let’s Encrypt certificate by using certbot. certbot is a tool created by Lets Encrypt to install and manage certificates. Refer to <a class="reference external" href="https://certbot.eff.org/instructions">certbot installation</a> for instructions on installing certbot (choose running on NGINX).</p>
<p>Once certbot is installed, run the certificate generation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">certbot</span> <span class="o">--</span><span class="n">nginx</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you run into the problem <code class="docutils literal notranslate"><span class="pre">&quot;The</span> <span class="pre">requested</span> <span class="pre">Nginx</span> <span class="pre">plugin</span> <span class="pre">does</span> <span class="pre">not</span> <span class="pre">appear</span> <span class="pre">to</span> <span class="pre">be</span> <span class="pre">installed&quot;</span></code>, install the plugin on Ubuntu via <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">python3-certbot-nginx</span></code>. Currently, for some reason the certbot installation page doesn’t mention this.</p>
</div>
<p>Answer all the prompts. For the prompt on redirecting HTTP traffic, it recommended you choose redirect traffic to ensure all users are using HTTPS. After completion, certbot will automatically update your NGINX configuration file.</p>
<section id="auto-renewal">
<h3>Auto-renewal<a class="headerlink" href="#auto-renewal" title="Link to this heading">¶</a></h3>
<p>The generated TLS certificate will typically expire after a period of time.</p>
<p>Its recommended to program your web server to automatically renew your certificate before this deadline, so you don’t have to do it manually. On Linux, you can program auto-renewal by using <a class="reference external" href="https://man7.org/linux/man-pages/man5/crontab.5.html">CronTab</a>. Add a Cronjob by running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">crontab</span> <span class="o">-</span><span class="n">e</span>
</pre></div>
</div>
<p>Then in your editor of choice, add a Cronjob to execute the certificate renewal program before it expires. With cerbot, the command is <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">certbot</span> <span class="pre">renew</span></code>. Below is a full example for a Cronjob running cerbot renew on the fifth day of every month at 3 am:</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">crontab configuration</span><a class="headerlink" href="#id5" title="Link to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">0</span> <span class="mi">3</span> <span class="mi">5</span> <span class="o">*</span> <span class="o">*</span> <span class="n">sudo</span> <span class="n">certbot</span> <span class="n">renew</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="view-your-application">
<h2>View your application<a class="headerlink" href="#view-your-application" title="Link to this heading">¶</a></h2>
<p>Your Rec League application is now fully deployed. View your website by either typing in the static IP address into your web browser or using your custom domain name. Test out all features to make sure everything is working correctly.</p>
<p>If you notice any issues with the application, please report on GitHub issues. Continue on to learn about the source code if you are interested in contributing to this project, or if you want to make personal changes to the code.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="api.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">API</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="flask_config.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Flask configuration</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, Patrick Eichler
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Deploying your website</a><ul>
<li><a class="reference internal" href="#setting-production-mode">Setting production mode</a></li>
<li><a class="reference internal" href="#disable-firewall">Disable firewall</a></li>
<li><a class="reference internal" href="#serving-the-application">Serving the application</a><ul>
<li><a class="reference internal" href="#id1">NGINX</a></li>
<li><a class="reference internal" href="#id2">Gunicorn</a></li>
<li><a class="reference internal" href="#id3">Supervisor</a></li>
</ul>
</li>
<li><a class="reference internal" href="#custom-domain-name">Custom domain name</a></li>
<li><a class="reference internal" href="#enabling-tls">Enabling TLS</a><ul>
<li><a class="reference internal" href="#auto-renewal">Auto-renewal</a></li>
</ul>
</li>
<li><a class="reference internal" href="#view-your-application">View your application</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=2709fde1"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=1dc612b0"></script>
    </body>
</html>